<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>カメラ映像</title>
</head>
<body>
  <div>
    <input type="button" value="ビデオ拡大" onclick="enlargeVideo()">
    <input type="button" value="ビデオ縮小" onclick="shrinkVideo()">
  </div>

  <br>

    <div>
            <video id="video0"></video>
            <video id="video1"></video>
            <video id="video2"></video>
            <video id="video3"></video>
    </div>
    <script>

    var arr = [];

      //デバイス一覧取得
      navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(handleError);

      //デバイス情報取得
      function gotDevices(deviceInfos) {
        // Handles being called several times to update labels. Preserve values.
        for (let i = 0; i !== deviceInfos.length; ++i) {
          const deviceInfo = deviceInfos[i];
          if (deviceInfo.kind === 'videoinput') {
            arr.push(deviceInfo.deviceId)
          } else if (deviceInfo.kind === 'audiooutput') { //audiooutputの時は何もしない
          } else if (deviceInfo.kind === 'audioinput') {  //audioinputの時は何もしない
          } else {
            console.log('Some other kind of source/device: ', deviceInfo);
          }
        }
        //開始
        start();
      }

      //デバイス取得エラー対応
      function handleError(error) {
        console.log('navigator.MediaDevices.getUserMedia error: ', error.message, error.name);
      }

//
//ビデオ再生
//
function start(){

    const video0 = document.getElementById("video0");
    const video1 = document.getElementById("video1");
    const video2 = document.getElementById("video2");
    const video3 = document.getElementById("video3");

    for (let i=0; i<4; i++){
      navigator.mediaDevices.getUserMedia({
          audio: false,
          //video: true,
            video: { deviceId: { exact: arr[i]} }
            //video: { deviceId: arr[3] },//背面カメラ
      }).then(stream => {
        switch (i){
          case '0';
            video0.srcObject = stream;
            video0.play()
          case '1';
            video1.srcObject = stream;
            video1.play()
          case '2';
            video2.srcObject = stream;
            video2.play()
          case '3';
            video3.srcObject = stream;
            video3.play()
        }
      }).catch(e => {
        console.log(e)
      })
    }


  /*
  //Video0再生
  const video0 = document.getElementById("video0")
  navigator.mediaDevices.getUserMedia({
      audio: false,
      //video: true,
        video: { deviceId: { exact: arr[0]} }
        //video: { deviceId: arr[3] },//背面カメラ
  }).then(stream => {
      video0.srcObject = stream;
      video0.play()
  }).catch(e => {
    console.log(e)
  })

  //Video1再生
  const video1 = document.getElementById("video1")
  navigator.mediaDevices.getUserMedia({
      audio: false,
      //video: true,
         //video: { facingMode: "user" },//インカメラ
         video: { deviceId: { exact: arr[1]} }
  }).then(stream => {
      video1.srcObject = stream;
      video1.play()
  }).catch(e => {
    console.log(e)
  })

  //Video2再生
  const video2 = document.getElementById("video2")
  navigator.mediaDevices.getUserMedia({
      audio: false,
      //video: true,
        //video: { facingMode: "environment" },//背面カメラ
        video: { deviceId: { exact: arr[2]} }
  }).then(stream => {
      video2.srcObject = stream;
      video2.play()
  }).catch(e => {
    console.log(e)
  })

  //Video3再生
  const video3 = document.getElementById("video3")
  navigator.mediaDevices.getUserMedia({
      audio: false,
      //video: true,
        video: { deviceId: { exact: arr[3]} }
        //video: { deviceId: arr[3] },//背面カメラ
  }).then(stream => {
      video3.srcObject = stream;
      video3.play()
  }).catch(e => {
    console.log(e)
  })
  */
}


//
//ビデオ拡大
//
function enlargeVideo() {
  for(let i = 0; i < 4; i++){
    var target = document.getElementById("video" + i);

    if (target.width === 0) {
      var orgWidth  = target.videoWidth;
      var orgHeight = target.videoHeight;
    } else {
      var orgWidth  = target.width;
      var orgHeight = target.height;
    }

    target.width = orgWidth*1.1;  //縦横1.1倍
    target.height = orgHeight*1.1;
  }
}

//
//ビデオ縮小
//
function shrinkVideo() {
  for(let i = 0; i < 4; i++){
    var target = document.getElementById("video" + i);

    if (target.width === 0) {
      var orgWidth  = target.videoWidth;
      var orgHeight = target.videoHeight;
    } else {
      var orgWidth  = target.width;
      var orgHeight = target.height;
    }

    target.width = orgWidth*0.9;  //縦横0.9倍
    target.height = orgHeight*0.9;
  }
}

    </script>
</body>
</html>
